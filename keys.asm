IDEAL
P386
MODEL FLAT, C
ASSUME cs:_TEXT,ds:FLAT,es:FLAT,fs:FLAT,gs:FLAT

;=============================================================================
; INCLUDES
;=============================================================================
include "globals.inc"
include "graphics.inc"
include "main.inc"
include "keys.inc"
include "debug.inc"

;=============================================================================
; CODE
;=============================================================================
CODESEG

; Wait for esc keystroke.
PROC isESCpressed
	USES eax

	mov	ah, 00h
	int	16h
	cmp al, 27			; 27 = ASCII code voor esc key
	jne @@notPressedESC ; if not pressed skip terminate function
		call terminateProcess
	@@notPressedESC:

	ret
ENDP isESCpressed

;Check if key is pressed.
PROC isKeypressed
	USES eax, ebx

	; Get latest key press
	; al contains an ASCII key code, check table below
	; ah contains the bios key code
	mov	ah, 00h
	int	16h
	; jnz @@endCases
	
	@@beginCases:

		cmp al, 27 ; ESC
		jne @@notPressedESC ; skip if not pressed
			call terminateProcess
			jmp @@endCases
		@@notPressedESC:

		cmp ah, 75
		jne @@notPressedLeft 
			; call leftPressed
			; call printString, offset left
			jmp @@endCases
		@@notPressedLeft:

		cmp ah, 77
		jne @@notPressedRight 
			; call rightPressed
			; call printString, offset right
			jmp @@endCases
		@@notPressedRight:

		cmp ah, 72
		jne @@notPressedUP
			; call rightPressed
			; call printString, offset up
			jmp @@endCases
		@@notPressedUP:

		cmp ah, 80
		jne @@notPressedDown
			; call rightPressed
			; call printString, offset down
			jmp @@endCases
		@@notPressedDown:

		; Default
		movzx ebx, al
		call printUnsignedInteger, ebx
		movzx ebx, ah
		call printUnsignedInteger, ebx
		call printString, offset sepp

	@@endCases:

	ret
ENDP isKeypressed

;=============================================================================
; Uninitialized DATA
;=============================================================================
UDATASEG

;=============================================================================
; DATA
;=============================================================================
DATASEG
	sepp db "--------", 10, 13, '$'
	up db "up", 10, 13, '$'
	down db "down", 10, 13, '$'
	left db "left", 10, 13, '$'
	right db "right", 10, 13, '$'

END 


; ╔═════════════════════════════════════════════════════════════════╦════════════╦════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
; ║                         Besturingscodes                         ║            ║                                                 spatie, afdrukbare tekens en delete                                                ║
; ╠═════╦═════╦═════╦════════╦══════════════════════════════════════╬════════════╬═════╦═════╦═════╦════════╦═══════╦════════════╦═════╦═════╦═════╦═════════╦═══════╦════════════╦═════╦═════╦═════╦═════════╦═══════╣
; ║ Dec ║ Oct ║ Hex ║ Binair ║ Teken                                ║            ║ Dec ║ Oct ║ Hex ║ Binair ║ Teken ║            ║ Dec ║ Oct ║ Hex ║ Binair  ║ Teken ║            ║ Dec ║ Oct ║ Hex ║ Binair  ║ Teken ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 0   ║ 0   ║ 0   ║ 0      ║ NUL (Null)                           ║            ║ 32  ║ 40  ║ 20  ║ 100000 ║ SP    ║            ║ 64  ║ 100 ║ 40  ║ 1000000 ║ @     ║            ║ 96  ║ 140 ║ 60  ║ 1100000 ║ `     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 1   ║ 1   ║ 1   ║ 1      ║ SOH (Start of Header)                ║            ║ 33  ║ 41  ║ 21  ║ 100001 ║ !     ║            ║ 65  ║ 101 ║ 41  ║ 1000001 ║ A     ║            ║ 97  ║ 141 ║ 61  ║ 1100001 ║ a     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 2   ║ 2   ║ 2   ║ 10     ║ STX (Start of Text)                  ║            ║ 34  ║ 42  ║ 22  ║ 100010 ║ "     ║            ║ 66  ║ 102 ║ 42  ║ 1000010 ║ B     ║            ║ 98  ║ 142 ║ 62  ║ 1100010 ║ b     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 3   ║ 3   ║ 3   ║ 11     ║ ETX (End of Text)                    ║            ║ 35  ║ 43  ║ 23  ║ 100011 ║ #     ║            ║ 67  ║ 103 ║ 43  ║ 1000011 ║ C     ║            ║ 99  ║ 143 ║ 63  ║ 1100011 ║ c     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 4   ║ 4   ║ 4   ║ 100    ║ EOT (End of Transmission)            ║            ║ 36  ║ 44  ║ 24  ║ 100100 ║ $     ║            ║ 68  ║ 104 ║ 44  ║ 1000100 ║ D     ║            ║ 100 ║ 144 ║ 64  ║ 1100100 ║ d     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 5   ║ 5   ║ 5   ║ 101    ║ ENQ (Enquiry)                        ║            ║ 37  ║ 45  ║ 25  ║ 100101 ║ %     ║            ║ 69  ║ 105 ║ 45  ║ 1000101 ║ E     ║            ║ 101 ║ 145 ║ 65  ║ 1100101 ║ e     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 6   ║ 6   ║ 6   ║ 110    ║ ACK (Acknowledgement)                ║            ║ 38  ║ 46  ║ 26  ║ 100110 ║ &     ║            ║ 70  ║ 106 ║ 46  ║ 1000110 ║ F     ║            ║ 102 ║ 146 ║ 66  ║ 1100110 ║ f     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 7   ║ 7   ║ 7   ║ 111    ║ BEL (Bell (geluidssignaal))          ║            ║ 39  ║ 47  ║ 27  ║ 100111 ║ '     ║            ║ 71  ║ 107 ║ 47  ║ 1000111 ║ G     ║            ║ 103 ║ 147 ║ 67  ║ 1100111 ║ g     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 8   ║ 10  ║ 8   ║ 1000   ║ BS (Backspace)                       ║            ║ 40  ║ 50  ║ 28  ║ 101000 ║ (     ║            ║ 72  ║ 110 ║ 48  ║ 1001000 ║ H     ║            ║ 104 ║ 150 ║ 68  ║ 1101000 ║ h     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 9   ║ 11  ║ 9   ║ 1001   ║ HT (Horizontal Tab)                  ║            ║ 41  ║ 51  ║ 29  ║ 101001 ║ )     ║            ║ 73  ║ 111 ║ 49  ║ 1001001 ║ I     ║            ║ 105 ║ 151 ║ 69  ║ 1101001 ║ i     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 10  ║ 12  ║ 0A  ║ 1010   ║ LF (Line Feed (nieuwe regel))        ║            ║ 42  ║ 52  ║ 2A  ║ 101010 ║ *     ║            ║ 74  ║ 112 ║ 4A  ║ 1001010 ║ J     ║            ║ 106 ║ 152 ║ 6A  ║ 1101010 ║ j     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 11  ║ 13  ║ 0B  ║ 1011   ║ VT (Vertical Tab)                    ║            ║ 43  ║ 53  ║ 2B  ║ 101011 ║ +     ║            ║ 75  ║ 113 ║ 4B  ║ 1001011 ║ K     ║            ║ 107 ║ 153 ║ 6B  ║ 1101011 ║ k     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 12  ║ 14  ║ 0C  ║ 1100   ║ FF (Form Feed)                       ║            ║ 44  ║ 54  ║ 2C  ║ 101100 ║ ,     ║            ║ 76  ║ 114 ║ 4C  ║ 1001100 ║ L     ║            ║ 108 ║ 154 ║ 6C  ║ 1101100 ║ l     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 13  ║ 15  ║ 0D  ║ 1101   ║ CR (Carriage Return)                 ║            ║ 45  ║ 55  ║ 2D  ║ 101101 ║ -     ║            ║ 77  ║ 115 ║ 4D  ║ 1001101 ║ M     ║            ║ 109 ║ 155 ║ 6D  ║ 1101101 ║ m     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 14  ║ 16  ║ 0E  ║ 1110   ║ SO (Shift Out)                       ║            ║ 46  ║ 56  ║ 2E  ║ 101110 ║ .     ║            ║ 78  ║ 116 ║ 4E  ║ 1001110 ║ N     ║            ║ 110 ║ 156 ║ 6E  ║ 1101110 ║ n     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 15  ║ 17  ║ 0F  ║ 1111   ║ SI (Shift In)                        ║            ║ 47  ║ 57  ║ 2F  ║ 101111 ║ /     ║            ║ 79  ║ 117 ║ 4F  ║ 1001111 ║ O     ║            ║ 111 ║ 157 ║ 6F  ║ 1101111 ║ o     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 16  ║ 20  ║ 10  ║ 10000  ║ DLE (Data Link Escape)               ║            ║ 48  ║ 60  ║ 30  ║ 110000 ║ 0     ║            ║ 80  ║ 120 ║ 50  ║ 1010000 ║ P     ║            ║ 112 ║ 160 ║ 70  ║ 1110000 ║ p     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 17  ║ 21  ║ 11  ║ 10001  ║ DC1 (Device Control 1 (XON))         ║            ║ 49  ║ 61  ║ 31  ║ 110001 ║ 1     ║            ║ 81  ║ 121 ║ 51  ║ 1010001 ║ Q     ║            ║ 113 ║ 161 ║ 71  ║ 1110001 ║ q     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 18  ║ 22  ║ 12  ║ 10010  ║ DC2 (Device Control 2)               ║            ║ 50  ║ 62  ║ 32  ║ 110010 ║ 2     ║            ║ 82  ║ 122 ║ 52  ║ 1010010 ║ R     ║            ║ 114 ║ 162 ║ 72  ║ 1110010 ║ r     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 19  ║ 23  ║ 13  ║ 10011  ║ DC3 (Device Control 3 (XOFF))        ║            ║ 51  ║ 63  ║ 33  ║ 110011 ║ 3     ║            ║ 83  ║ 123 ║ 53  ║ 1010011 ║ S     ║            ║ 115 ║ 163 ║ 73  ║ 1110011 ║ s     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 20  ║ 24  ║ 14  ║ 10100  ║ DC4 (Device Control 4)               ║            ║ 52  ║ 64  ║ 34  ║ 110100 ║ 4     ║            ║ 84  ║ 124 ║ 54  ║ 1010100 ║ T     ║            ║ 116 ║ 164 ║ 74  ║ 1110100 ║ t     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 21  ║ 25  ║ 15  ║ 10101  ║ NAK (Negative Acknowledgement)       ║            ║ 53  ║ 65  ║ 35  ║ 110101 ║ 5     ║            ║ 85  ║ 125 ║ 55  ║ 1010101 ║ U     ║            ║ 117 ║ 165 ║ 75  ║ 1110101 ║ u     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 22  ║ 26  ║ 16  ║ 10110  ║ SYN (Synchronous Idle)               ║            ║ 54  ║ 66  ║ 36  ║ 110110 ║ 6     ║            ║ 86  ║ 126 ║ 56  ║ 1010110 ║ V     ║            ║ 118 ║ 166 ║ 76  ║ 1110110 ║ v     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 23  ║ 27  ║ 17  ║ 10111  ║ ETB (End of Transmission Block)      ║            ║ 55  ║ 67  ║ 37  ║ 110111 ║ 7     ║            ║ 87  ║ 127 ║ 57  ║ 1010111 ║ W     ║            ║ 119 ║ 167 ║ 77  ║ 1110111 ║ w     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 24  ║ 30  ║ 18  ║ 11000  ║ CAN (Cancel)                         ║            ║ 56  ║ 70  ║ 38  ║ 111000 ║ 8     ║            ║ 88  ║ 130 ║ 58  ║ 1011000 ║ X     ║            ║ 120 ║ 170 ║ 78  ║ 1111000 ║ x     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 25  ║ 31  ║ 19  ║ 11001  ║ EM (End of Medium)                   ║            ║ 57  ║ 71  ║ 39  ║ 111001 ║ 9     ║            ║ 89  ║ 131 ║ 59  ║ 1011001 ║ Y     ║            ║ 121 ║ 171 ║ 79  ║ 1111001 ║ y     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 26  ║ 32  ║ 1A  ║ 11010  ║ SUB (Substitute)                     ║            ║ 58  ║ 72  ║ 3A  ║ 111010 ║ :     ║            ║ 90  ║ 132 ║ 5A  ║ 1011010 ║ Z     ║            ║ 122 ║ 172 ║ 7A  ║ 1111010 ║ z     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 27  ║ 33  ║ 1B  ║ 11011  ║ ESC (Escape)                         ║            ║ 59  ║ 73  ║ 3B  ║ 111011 ║ ;     ║            ║ 91  ║ 133 ║ 5B  ║ 1011011 ║ [     ║            ║ 123 ║ 173 ║ 7B  ║ 1111011 ║ {     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 28  ║ 34  ║ 1C  ║ 11100  ║ FS (File Separator)                  ║            ║ 60  ║ 74  ║ 3C  ║ 111100 ║ <     ║            ║ 92  ║ 134 ║ 5C  ║ 1011100 ║ \     ║            ║ 124 ║ 174 ║ 7C  ║ 1111100 ║ |     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 29  ║ 35  ║ 1D  ║ 11101  ║ GS (Group Separator)                 ║            ║ 61  ║ 75  ║ 3D  ║ 111101 ║ =     ║            ║ 93  ║ 135 ║ 5D  ║ 1011101 ║ ]     ║            ║ 125 ║ 175 ║ 7D  ║ 1111101 ║ }     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 30  ║ 36  ║ 1E  ║ 11110  ║ RS (Record Separator)                ║            ║ 62  ║ 76  ║ 3E  ║ 111110 ║ >     ║            ║ 94  ║ 136 ║ 5E  ║ 1011110 ║ ^     ║            ║ 126 ║ 176 ║ 7E  ║ 1111110 ║ ~     ║
; ╠═════╬═════╬═════╬════════╬══════════════════════════════════════╬════════════╬═════╬═════╬═════╬════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╬════════════╬═════╬═════╬═════╬═════════╬═══════╣
; ║ 31  ║ 37  ║ 1F  ║ 11111  ║ US (Unit Separator)                  ║            ║ 63  ║ 77  ║ 3F  ║ 111111 ║ ?     ║            ║ 95  ║ 137 ║ 5F  ║ 1011111 ║ _     ║            ║ 127 ║ 177 ║ 7F  ║ 1111111 ║ DEL   ║
; ╚═════╩═════╩═════╩════════╩══════════════════════════════════════╩════════════╩═════╩═════╩═════╩════════╩═══════╩════════════╩═════╩═════╩═════╩═════════╩═══════╩════════════╩═════╩═════╩═════╩═════════╩═══════╝